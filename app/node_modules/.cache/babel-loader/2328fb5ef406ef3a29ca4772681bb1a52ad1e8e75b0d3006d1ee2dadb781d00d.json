{"ast":null,"code":"var createPatternBuilder = require('./createPatternBuilder');\nmodule.exports = generateIntegratorFunction;\nmodule.exports.generateIntegratorFunctionBody = generateIntegratorFunctionBody;\nfunction generateIntegratorFunction(dimension) {\n  var code = generateIntegratorFunctionBody(dimension);\n  return new Function('bodies', 'timeStep', 'adaptiveTimeStepWeight', code);\n}\nfunction generateIntegratorFunctionBody(dimension) {\n  var pattern = createPatternBuilder(dimension);\n  var code = \"\\n  var length = bodies.length;\\n  if (length === 0) return 0;\\n\\n  \".concat(pattern('var d{var} = 0, t{var} = 0;', {\n    indent: 2\n  }), \"\\n\\n  for (var i = 0; i < length; ++i) {\\n    var body = bodies[i];\\n    if (body.isPinned) continue;\\n\\n    if (adaptiveTimeStepWeight && body.springCount) {\\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\\n    }\\n\\n    var coeff = timeStep / body.mass;\\n\\n    \").concat(pattern('body.velocity.{var} += coeff * body.force.{var};', {\n    indent: 4\n  }), \"\\n    \").concat(pattern('var v{var} = body.velocity.{var};', {\n    indent: 4\n  }), \"\\n    var v = Math.sqrt(\").concat(pattern('v{var} * v{var}', {\n    join: ' + '\n  }), \");\\n\\n    if (v > 1) {\\n      // We normalize it so that we move within timeStep range. \\n      // for the case when v <= 1 - we let velocity to fade out.\\n      \").concat(pattern('body.velocity.{var} = v{var} / v;', {\n    indent: 6\n  }), \"\\n    }\\n\\n    \").concat(pattern('d{var} = timeStep * body.velocity.{var};', {\n    indent: 4\n  }), \"\\n\\n    \").concat(pattern('body.pos.{var} += d{var};', {\n    indent: 4\n  }), \"\\n\\n    \").concat(pattern('t{var} += Math.abs(d{var});', {\n    indent: 4\n  }), \"\\n  }\\n\\n  return (\").concat(pattern('t{var} * t{var}', {\n    join: ' + '\n  }), \")/length;\\n\");\n  return code;\n}","map":{"version":3,"names":["createPatternBuilder","require","module","exports","generateIntegratorFunction","generateIntegratorFunctionBody","dimension","code","Function","pattern","concat","indent","join"],"sources":["/Users/Shivam/Library/CloudStorage/GoogleDrive-sraval@g.harvard.edu/My Drive/Github/embedding-modifier/app/node_modules/ngraph.forcelayout/lib/codeGenerators/generateIntegrator.js"],"sourcesContent":["const createPatternBuilder = require('./createPatternBuilder');\n\nmodule.exports = generateIntegratorFunction;\nmodule.exports.generateIntegratorFunctionBody = generateIntegratorFunctionBody;\n\nfunction generateIntegratorFunction(dimension) {\n  let code = generateIntegratorFunctionBody(dimension);\n  return new Function('bodies', 'timeStep', 'adaptiveTimeStepWeight', code);\n}\n\nfunction generateIntegratorFunctionBody(dimension) {\n  let pattern = createPatternBuilder(dimension);\n  let code = `\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${pattern('var d{var} = 0, t{var} = 0;', {indent: 2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${pattern('body.velocity.{var} += coeff * body.force.{var};', {indent: 4})}\n    ${pattern('var v{var} = body.velocity.{var};', {indent: 4})}\n    var v = Math.sqrt(${pattern('v{var} * v{var}', {join: ' + '})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${pattern('body.velocity.{var} = v{var} / v;', {indent: 6})}\n    }\n\n    ${pattern('d{var} = timeStep * body.velocity.{var};', {indent: 4})}\n\n    ${pattern('body.pos.{var} += d{var};', {indent: 4})}\n\n    ${pattern('t{var} += Math.abs(d{var});', {indent: 4})}\n  }\n\n  return (${pattern('t{var} * t{var}', {join: ' + '})})/length;\n`;\n  return code;\n}\n"],"mappings":"AAAA,IAAMA,oBAAoB,GAAGC,OAAO,CAAC,wBAAwB,CAAC;AAE9DC,MAAM,CAACC,OAAO,GAAGC,0BAA0B;AAC3CF,MAAM,CAACC,OAAO,CAACE,8BAA8B,GAAGA,8BAA8B;AAE9E,SAASD,0BAA0BA,CAACE,SAAS,EAAE;EAC7C,IAAIC,IAAI,GAAGF,8BAA8B,CAACC,SAAS,CAAC;EACpD,OAAO,IAAIE,QAAQ,CAAC,QAAQ,EAAE,UAAU,EAAE,wBAAwB,EAAED,IAAI,CAAC;AAC3E;AAEA,SAASF,8BAA8BA,CAACC,SAAS,EAAE;EACjD,IAAIG,OAAO,GAAGT,oBAAoB,CAACM,SAAS,CAAC;EAC7C,IAAIC,IAAI,0EAAAG,MAAA,CAIND,OAAO,CAAC,6BAA6B,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,6SAAAD,MAAA,CAYjDD,OAAO,CAAC,kDAAkD,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,YAAAD,MAAA,CACxED,OAAO,CAAC,mCAAmC,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,8BAAAD,MAAA,CACvCD,OAAO,CAAC,iBAAiB,EAAE;IAACG,IAAI,EAAE;EAAK,CAAC,CAAC,wKAAAF,MAAA,CAKzDD,OAAO,CAAC,mCAAmC,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,qBAAAD,MAAA,CAG3DD,OAAO,CAAC,0CAA0C,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,cAAAD,MAAA,CAEhED,OAAO,CAAC,2BAA2B,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,cAAAD,MAAA,CAEjDD,OAAO,CAAC,6BAA6B,EAAE;IAACE,MAAM,EAAE;EAAC,CAAC,CAAC,yBAAAD,MAAA,CAG7CD,OAAO,CAAC,iBAAiB,EAAE;IAACG,IAAI,EAAE;EAAK,CAAC,CAAC,gBACpD;EACC,OAAOL,IAAI;AACb"},"metadata":{},"sourceType":"script","externalDependencies":[]}