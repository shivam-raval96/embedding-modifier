{"ast":null,"code":"import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereGeometry, CylinderGeometry, TubeGeometry, ConeGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n  return _construct.apply(null, arguments);\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return _assertThisInitialized(self);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\nvar _excluded = [\"objFilter\"];\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref$objFilter = _ref.objFilter,\n    objFilter = _ref$objFilter === void 0 ? function () {\n      return true;\n    } : _ref$objFilter,\n    options = _objectWithoutProperties(_ref, _excluded);\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\nvar autoColorScale = scaleOrdinal(schemePaired);\n\n// Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n    links = _ref.links;\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$nodeFilter = _ref2.nodeFilter,\n    nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n      return true;\n    } : _ref2$nodeFilter,\n    _ref2$onLoopError = _ref2.onLoopError,\n    onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n      throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n    } : _ref2$onLoopError;\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n      target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      node = _ref5[1];\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      id = _ref7[0],\n      node = _ref7[1];\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var _loop = function _loop() {\n      var node = nodes[i];\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n        return \"continue\";\n      }\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var _ret = _loop();\n      if (_ret === \"continue\") continue;\n    }\n  }\n}\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereGeometry: SphereGeometry,\n  CylinderGeometry: CylinderGeometry,\n  TubeGeometry: TubeGeometry,\n  ConeGeometry: ConeGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\n//\n\nvar DAG_LEVEL_NODE_RATIO = 2;\n\n// support multiple method names for backwards threejs compatibility\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge');\n        // Increase repulsion on 3D mode for improved spatial separation\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    nodePositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the node's position. Signature: (threeObj, { x, y, z}, node). If the function returns a truthy value, the regular node position update will not run.\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n      state._rerender();\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      if (state.engineRunning) {\n        layoutTick();\n      }\n      updateArrows();\n      updatePhotons();\n      return this;\n\n      //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n          state.onEngineTick();\n        }\n        var nodeThreeObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n\n        // Update nodes position\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          var extendedObj = nodeThreeObjectExtendAccessor(node);\n          if (!state.nodePositionUpdate || !state.nodePositionUpdate(extendedObj ? obj.children[0] : obj, {\n            x: pos.x,\n            y: pos.y,\n            z: pos.z\n          }, node) // pass child custom object if extending the default\n          || extendedObj) {\n            obj.position.x = pos.x;\n            obj.position.y = pos.y || 0;\n            obj.position.z = pos.z || 0;\n          }\n        });\n\n        // Update links position\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj,\n          // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n          var curveResolution = 30; // # line segments\n          var curve = link.__curve;\n\n          // select default line obj if it's an extended group\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n              var _r = _linkWidth / 2;\n              var _geometry = new three$1.TubeGeometry(curve, curveResolution, _r, state.linkResolution, false);\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        });\n\n        //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n            link.__curve = curve;\n          }\n        }\n      }\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.cbrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.cbrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n          arrowObj.lookAt(headVec);\n        });\n      }\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n            photon.__progressRatio += particleSpeed;\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link && state.graphData.links.includes(link)) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        });\n\n        // add a single hop particle\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null;\n\n      // recursively collect all nested geometries bboxes\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n      if (!bboxes.length) return null;\n\n      // extract global x,y,z min/max\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n    state.engineRunning = false; // pause simulation\n    state.onUpdate();\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    }\n\n    // Digest nodes WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([\n        // recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n          var obj;\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereGeometry(radius, numSegments, numSegments);\n              }\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    }\n\n    // Digest links WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n      var _colorAccessor = accessorFn(state.linkColor);\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor);\n\n      // lines digest cycle\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([\n        // recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        exitObj: function exitObj(obj) {\n          // remove trailing single photons\n          var singlePhotonsObj = obj.__data && obj.__data.__singleHopPhotonsObj;\n          if (singlePhotonsObj) {\n            singlePhotonsObj.parent.remove(singlePhotonsObj);\n            emptyObject(singlePhotonsObj);\n            delete obj.__data.__singleHopPhotonsObj;\n          }\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n          var extendObj = _customObjectExtendAccessor(link);\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n          var defaultObj;\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n          var obj;\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n            var customMaterial = customMaterialAccessor(link);\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      });\n\n      // Arrows digest cycle\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeGeometry(arrowLength * 0.25, arrowLength, numSegments);\n              // Correct orientation\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n            var arrowColor = arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            obj.material.color = new three$1.Color(colorStr2Hex(arrowColor));\n            obj.material.opacity = state.linkOpacity * 3 * colorAlpha(arrowColor);\n          }\n        });\n      }\n\n      // Photon particles digest cycle\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n              }\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            }\n\n            // digest cycle for each photon\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n    state._flushObjects = false; // reset objects refresh flag\n\n    // simulation engine\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n\n      // parse links\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      });\n\n      // Feed data to force-directed layout\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes);\n\n        // add links (if link force is still active)\n        var linkForce = state.d3ForceLayout.force('link');\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        }\n\n        // setup dag force constraints\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1);\n\n        // Fix nodes to x,y,z for dag mode\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        }\n\n        // Use radial force for radial dags\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\nfunction fromKapsule(kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n    var _super = _createSuper(FromKapsule);\n    function FromKapsule() {\n      var _this;\n      _classCallCheck(this, FromKapsule);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n    return _createClass(FromKapsule);\n  }(baseClass); // attach kapsule props/methods to class prototype\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\nexport { threeForcegraph as default };","map":{"version":3,"names":["Group","Mesh","MeshLambertMaterial","Color","BufferGeometry","BufferAttribute","Matrix4","Vector3","SphereGeometry","CylinderGeometry","TubeGeometry","ConeGeometry","Line","LineBasicMaterial","QuadraticBezierCurve3","CubicBezierCurve3","Box3","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","graph","forcelayout","Kapsule","accessorFn","min","max","dataJoint","scaleOrdinal","schemePaired","tinyColor","_iterableToArrayLimit","arr","i","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","Object","done","push","value","length","err","return","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","_objectSpread2","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_typeof","obj","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_toPropertyKey","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","bind","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","e","_construct","Parent","args","Class","a","Function","_objectWithoutPropertiesLoose","excluded","sourceKeys","indexOf","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","_slicedToArray","_arrayWithHoles","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","minLen","n","toString","slice","name","test","len","arr2","_toPrimitive","input","hint","prim","toPrimitive","undefined","res","String","Number","arg","materialDispose","material","map","dispose","deallocate","geometry","texture","children","emptyObject","childObj","remove","_excluded","threeDigest","data","scene","_ref","_ref$objFilter","objFilter","options","add","objBindAttr","colorStr2Hex","str","isNaN","parseInt","toHex","colorAlpha","getAlpha","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","node","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","_ref6","_ref7","id","nodeStack","currentDepth","_loop","loop","d","some","foundLoop","every","idx","l","_ret","three$1","window","THREE","ngraph","DAG_LEVEL_NODE_RATIO","setAttributeFn","setAttribute","applyMatrix4Fn","applyMatrix4","ForceGraph","jsonUrl","onChange","state","_this","fetchingJson","onLoading","fetch","then","r","json","onFinishLoading","graphData","triggerUpdate","engineRunning","numDimensions","numDim","chargeForce","d3ForceLayout","force","strength","eraseDimension","dim","dagMode","forceEngine","fx","fy","fz","dagLevelDistance","dagNodeFilter","_default","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","d3AlphaMin","d3AlphaDecay","alphaDecay","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","ngraphPhysics","timeStep","gravity","theta","springLength","springCoefficient","dragCoefficient","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","refresh","_flushObjects","_rerender","d3Force","forceName","forceFn","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","Date","tickFrame","isD3Sim","layoutTick","updateArrows","updatePhotons","layout","nodeThreeObjectExtendAccessor","__threeObj","pos","getNodePosition","extendedObj","x","y","z","position","linkWidthAccessor","linkCurvatureAccessor","linkCurveRotationAccessor","linkThreeObjectExtendAccessor","link","lineObj","__lineObj","getLinkPosition","getLink","start","end","calcLinkCurve","curveResolution","curve","__curve","line","type","linePos","getAttribute","array","Float32Array","needsUpdate","setFromPoints","getPoints","computeBoundingSphere","match","Math","ceil","makeTranslation","makeRotationX","PI","vStart","vEnd","distance","distanceTo","scale","parent","localToWorld","lookAt","set","rotation","_linkWidth","_geometry","curvature","curveRotation","dx","dy","vLine","subVectors","cp","clone","multiplyScalar","cross","applyAxisAngle","normalize","addVectors","divideScalar","endAngle","startAngle","cos","sin","arrowRelPosAccessor","arrowLengthAccessor","nodeValAccessor","arrowObj","__arrowObj","startR","cbrt","endR","arrowLength","arrowRelPos","getPosAlongLine","t","getPoint","iplt","lineLen","getLength","sqrt","pow","reduce","acc","v","posAlongLine","arrowHead","arrowTail","headVec","c","particleSpeedAccessor","cyclePhotons","__photonsObj","singleHopPhotons","__singleHopPhotonsObj","particleSpeed","getPhotonPos","photons","photon","singleHop","__linkThreeObjType","__progressRatio","photonPosRatio","emitParticle","includes","graphScene","particleWidthAccessor","photonR","numSegments","particleGeometry","linkColorAccessor","particleColorAccessor","photonColor","materialColor","opacity","particleMaterial","color","transparent","getGraphBbox","initialised","bboxes","getBboxes","computeBoundingBox","box","copy","boundingBox","matrixWorld","__graphObjType","__data","bb","stateInit","stop","init","threeObj","update","changedProps","hasAnyPropChanged","propList","customObjectAccessor","customObjectExtendAccessor","valAccessor","colorAccessor","visibilityAccessor","sphereGeometries","sphereMaterials","purge","createObj","customObj","extendObj","__graphDefaultObj","updateObj","val","radius","parameters","widthSegments","equals","_customObjectAccessor","_customObjectExtendAccessor","customMaterialAccessor","_visibilityAccessor","_colorAccessor","widthAccessor","cylinderGeometries","lambertLineMaterials","basicLineMaterials","visibleLinks","exitObj","singlePhotonsObj","defaultObj","useCylinder","lineGeometry","renderOrder","updObj","radiusTop","radialSegments","customMaterial","materialType","lineMaterials","depthWrite","arrowColorAccessor","height","coneGeometry","translate","rotateX","arrowColor","particlesAccessor","particleMaterials","particleGeometries","numPhotons","round","abs","curPhoton","_","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","fzFn","nodeDepth","_graph","addNode","addLink","dimensions","fromKapsule","kapsule","baseClass","initKapsuleWithSelf","FromKapsule","_baseClass","_super","_len","_key","__kapsuleInstance","m","_this$__kapsuleInstan","returnVal","three","threeForcegraph","default"],"sources":["/Users/Shivam/Library/CloudStorage/GoogleDrive-sraval@g.harvard.edu/My Drive/Github/embedding-modifier/app/node_modules/three-forcegraph/dist/three-forcegraph.mjs"],"sourcesContent":["import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereGeometry, CylinderGeometry, TubeGeometry, ConeGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n  return _construct.apply(null, arguments);\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return _assertThisInitialized(self);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref$objFilter = _ref.objFilter,\n    objFilter = _ref$objFilter === void 0 ? function () {\n      return true;\n    } : _ref$objFilter,\n    options = _objectWithoutProperties(_ref, _excluded);\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\nvar autoColorScale = scaleOrdinal(schemePaired);\n\n// Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n    links = _ref.links;\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$nodeFilter = _ref2.nodeFilter,\n    nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n      return true;\n    } : _ref2$nodeFilter,\n    _ref2$onLoopError = _ref2.onLoopError,\n    onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n      throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n    } : _ref2$onLoopError;\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n      target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      node = _ref5[1];\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      id = _ref7[0],\n      node = _ref7[1];\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var _loop = function _loop() {\n      var node = nodes[i];\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n        return \"continue\";\n      }\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var _ret = _loop();\n      if (_ret === \"continue\") continue;\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereGeometry: SphereGeometry,\n  CylinderGeometry: CylinderGeometry,\n  TubeGeometry: TubeGeometry,\n  ConeGeometry: ConeGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\n//\n\nvar DAG_LEVEL_NODE_RATIO = 2;\n\n// support multiple method names for backwards threejs compatibility\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge');\n        // Increase repulsion on 3D mode for improved spatial separation\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    nodePositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the node's position. Signature: (threeObj, { x, y, z}, node). If the function returns a truthy value, the regular node position update will not run.\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n      state._rerender();\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      if (state.engineRunning) {\n        layoutTick();\n      }\n      updateArrows();\n      updatePhotons();\n      return this;\n\n      //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n          state.onEngineTick();\n        }\n        var nodeThreeObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n\n        // Update nodes position\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          var extendedObj = nodeThreeObjectExtendAccessor(node);\n          if (!state.nodePositionUpdate || !state.nodePositionUpdate(extendedObj ? obj.children[0] : obj, {\n            x: pos.x,\n            y: pos.y,\n            z: pos.z\n          }, node) // pass child custom object if extending the default\n          || extendedObj) {\n            obj.position.x = pos.x;\n            obj.position.y = pos.y || 0;\n            obj.position.z = pos.z || 0;\n          }\n        });\n\n        // Update links position\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj,\n          // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n          var curveResolution = 30; // # line segments\n          var curve = link.__curve;\n\n          // select default line obj if it's an extended group\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n              var _r = _linkWidth / 2;\n              var _geometry = new three$1.TubeGeometry(curve, curveResolution, _r, state.linkResolution, false);\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        });\n\n        //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n            link.__curve = curve;\n          }\n        }\n      }\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.cbrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.cbrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n          arrowObj.lookAt(headVec);\n        });\n      }\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n            photon.__progressRatio += particleSpeed;\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link && state.graphData.links.includes(link)) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        });\n\n        // add a single hop particle\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null;\n\n      // recursively collect all nested geometries bboxes\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n      if (!bboxes.length) return null;\n\n      // extract global x,y,z min/max\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n    state.engineRunning = false; // pause simulation\n    state.onUpdate();\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    }\n\n    // Digest nodes WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([\n        // recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n          var obj;\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereGeometry(radius, numSegments, numSegments);\n              }\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    }\n\n    // Digest links WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n      var _colorAccessor = accessorFn(state.linkColor);\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor);\n\n      // lines digest cycle\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([\n        // recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        exitObj: function exitObj(obj) {\n          // remove trailing single photons\n          var singlePhotonsObj = obj.__data && obj.__data.__singleHopPhotonsObj;\n          if (singlePhotonsObj) {\n            singlePhotonsObj.parent.remove(singlePhotonsObj);\n            emptyObject(singlePhotonsObj);\n            delete obj.__data.__singleHopPhotonsObj;\n          }\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n          var extendObj = _customObjectExtendAccessor(link);\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n          var defaultObj;\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n          var obj;\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n            var customMaterial = customMaterialAccessor(link);\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      });\n\n      // Arrows digest cycle\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeGeometry(arrowLength * 0.25, arrowLength, numSegments);\n              // Correct orientation\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n            var arrowColor = arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            obj.material.color = new three$1.Color(colorStr2Hex(arrowColor));\n            obj.material.opacity = state.linkOpacity * 3 * colorAlpha(arrowColor);\n          }\n        });\n      }\n\n      // Photon particles digest cycle\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n              }\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            }\n\n            // digest cycle for each photon\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n    state._flushObjects = false; // reset objects refresh flag\n\n    // simulation engine\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n\n      // parse links\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      });\n\n      // Feed data to force-directed layout\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes);\n\n        // add links (if link force is still active)\n        var linkForce = state.d3ForceLayout.force('link');\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        }\n\n        // setup dag force constraints\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1);\n\n        // Fix nodes to x,y,z for dag mode\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        }\n\n        // Use radial force for radial dags\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule (kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n    var _super = _createSuper(FromKapsule);\n    function FromKapsule() {\n      var _this;\n      _classCallCheck(this, FromKapsule);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n    return _createClass(FromKapsule);\n  }(baseClass); // attach kapsule props/methods to class prototype\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\n\nexport { threeForcegraph as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}