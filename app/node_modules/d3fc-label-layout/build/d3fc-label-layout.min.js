!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array"),require("d3-selection"),require("d3-scale"),require("d3fc-data-join"),require("d3fc-rebind")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-selection","d3-scale","d3fc-data-join","d3fc-rebind"],n):n(t.fc=t.fc||{},t.d3,t.d3,t.d3,t.fc,t.fc)}(this,function(t,n,e,r,i,o){"use strict";var u=function(t){return"function"==typeof t?t:function(){return t}},c=function(t){var n=function(){},c=function(){return[0,0]},a=function(t,n){return[t.x,t.y]},h=t||function(t){return t},f=function(){},l=r.scaleIdentity(),d=r.scaleIdentity(),g=i.dataJoin("g","label"),y=function(t){t.each(function(t,r,i){var o=g(e.select(i[r]),t).call(f),u=o.nodes(),y=u.map(function(t,n){var r=e.select(t).datum(),i=a(r,n,u),o=[l(i[0]),d(i[1])],h=c(r,n,u);return{hidden:!1,x:o[0],y:o[1],width:h[0],height:h[1]}}),s=h(y);o.attr("style",function(t,n){return"display:"+(s[n].hidden?"none":"inherit")}).attr("transform",function(t,n){return"translate("+s[n].x+", "+s[n].y+")"}).attr("layout-width",function(t,n){return s[n].width}).attr("layout-height",function(t,n){return s[n].height}).attr("anchor-x",function(t,n,e){return y[n].x-s[n].x}).attr("anchor-y",function(t,n,e){return y[n].y-s[n].y}),o.call(f),n(o,t,r)})};return o.rebindAll(y,g,o.include("key")),o.rebindAll(y,h),y.size=function(){return arguments.length?(c=u(arguments.length<=0?void 0:arguments[0]),y):c},y.position=function(){return arguments.length?(a=u(arguments.length<=0?void 0:arguments[0]),y):a},y.component=function(){return arguments.length?(f=arguments.length<=0?void 0:arguments[0],y):f},y.decorate=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],y):n},y.xScale=function(){return arguments.length?(l=arguments.length<=0?void 0:arguments[0],y):l},y.yScale=function(){return arguments.length?(d=arguments.length<=0?void 0:arguments[0],y):d},y},a=function(t){var n=2,r=function(t){return t},o=i.dataJoin("text"),c=i.dataJoin("rect"),a=i.dataJoin("circle"),h=function(t){t.each(function(t,i,u){var h=u[i],f=e.select(h),l=Number(h.getAttribute("layout-width")),d=Number(h.getAttribute("layout-height"));c(f,[t]).attr("width",l).attr("height",d);var g=Number(h.getAttribute("anchor-x")),y=Number(h.getAttribute("anchor-y"));a(f,[t]).attr("r",2).attr("cx",g).attr("cy",y);var s=o(f,[t]);s.enter().attr("dy","0.9em").attr("transform","translate("+n+", "+n+")"),s.text(r)})};return h.padding=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],h):n},h.value=function(){return arguments.length?(r=u(arguments.length<=0?void 0:arguments[0]),h):r},h},h=function(t,n){return!(t.x>=n.x+n.width||t.x+t.width<=n.x||t.y>=n.y+n.height||t.y+t.height<=n.y)},f=function(t,n){if(h(t,n)){var e=Math.max(t.x,n.x),r=Math.min(t.x+t.width,n.x+n.width),i=Math.max(t.y,n.y);return(r-e)*(Math.min(t.y+t.height,n.y+n.height)-i)}return 0},l=function(t,e){return n.sum(t.map(function(n,r){return e===r?0:f(t[e],n)}))},d=function(t,n,e,r,i){return{x:t,y:n,width:e,height:r,location:i}},g=function(t){var n=t.x,e=t.y,r=t.width,i=t.height;return[d(n,e,r,i,"bottom-right"),d(n-r,e,r,i,"bottom-left"),d(n-r,e-i,r,i,"top-left"),d(n,e-i,r,i,"top-right"),d(n,e-i/2,r,i,"middle-right"),d(n-r/2,e,r,i,"bottom-center"),d(n-r,e-i/2,r,i,"middle-left"),d(n-r/2,e-i,r,i,"top-center")]},y=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)},s=function(t,n,e){return[].concat(y(t.slice(0,n)),[e],y(t.slice(n+1)))},v=function(t,n){return t<n},m=function t(){var e=null,r=v,i=function(){return 0},o=void 0,u=function(t,n){return e-i(o[n],n,o)+i(t,n,s(o,n,t))},c=function c(a,h){e||(e=n.sum(o.map(function(t,n){return i(t,n,o)})));var f=u(a,h);return r(f,e)?t().locationScore(i).winningScore(r).score(f).rectangles(s(o,h,a)):c};return c.rectangles=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],c):o},c.score=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],c):e},c.winningScore=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],c):r},c.locationScore=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],c):i},c},x=function(){var t=void 0,n=function(n){return t?n.width*n.height-f(n,t):0},e=function(t,e,r){return l(r,e)+n(t)},r=function(t){var n=m().locationScore(e).rectangles(t);return t.forEach(function(t,e){g(t).forEach(function(t,r){n=n(t,e)})}),n.rectangles()};return r.bounds=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],r):t},r},b=function(t){return t[p(t)]},p=function(t){return Math.floor(Math.random()*t.length)},w=function(){var t=1e3,n=1,e=void 0,r=function(t){switch(t.location){case"bottom-right":return 0;case"middle-right":case"bottom-center":return t.width*t.height/8}return t.width*t.height/4},i=function(t){return e?t.width*t.height-f(t,e):0},o=function(t,n,e){return l(e,n)+i(t)+r(t)},u=function(e){for(var r=t,i=function(t,n){return Math.exp((n-t)/r)>Math.random()},u=m().locationScore(o).winningScore(i).rectangles(e);r>0;){var c=p(e);u=u(b(g(e[c])),c),r-=n}return u.rectangles()};return u.temperature=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],u):t},u.cooling=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],u):n},u.bounds=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],u):e},u},A=function(t,e){return t[n.scan(t,e)]},M=function(t){t=t||function(t){return t};var n=function(n){n=t(n);for(;;){if("break"===function(){var t=n.filter(function(t){return!t.hidden}),e=t.map(function(n,e){return[n,l(t,e)]}),r=A(e,function(t,n){return n[1]-t[1]});if(!(r[1]>0))return"break";r[0].hidden=!0}())break}return n};return o.rebindAll(n,t),n},S=function(){var t=[0,0],n=function(n){return n.map(function(n,e){var r=n.x,i=n.y;return r+n.width>t[0]&&(r-=n.width),i+n.height>t[1]&&(i-=n.height),{height:n.height,width:n.width,x:r,y:i}})};return n.bounds=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n};t.layoutLabel=c,t.layoutTextLabel=a,t.layoutGreedy=x,t.layoutAnnealing=w,t.layoutRemoveOverlaps=M,t.layoutBoundingBox=S,Object.defineProperty(t,"__esModule",{value:!0})});